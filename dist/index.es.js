import{useState as e,useRef as t,useEffect as r}from"react";import{TextField as n}from"@mui/material";import{format as u}from"date-fns";import i from"lodash";function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o.apply(this,arguments)}const s={none:{start:0,end:0},hours:{start:0,end:2,previous:"meridiem",next:"minutes",pattern:/^[0-9]+$/},minutes:{start:3,end:5,previous:"hours",next:"meridiem",pattern:/^[0-9]+$/},meridiem:{start:6,end:8,previous:"minutes",next:"hours",pattern:/^[AMP]/}},a=({value:a,label:m,onBlur:l,disabled:c,...d})=>{const[p,h]=e("none"),[b,f]=e(null),[v,w]=e(0),g=t(),S=t(null),A=()=>w((e=>e+1)),N=e=>{f((t=>{let{hours:r,minutes:n,meridiem:u}=t;return"hours"===p&&(r="up"===e?"12"===r?" 1":String(Number(r)+1).padStart(2," "):" 1"===r?"12":String(Number(r)-1).padStart(2," ")),"minutes"===p&&(n="up"===e?"59"===n?"00":String(Number(n)+1).padStart(2,"0"):"00"===n?"59":String(Number(n)-1).padStart(2,"0")),"meridiem"===p&&(u="AM"===u?"PM":"AM"),{hours:r,minutes:n,meridiem:u}}))};return r((()=>{!0!==c&&void 0!==g.current&&(S.current=Date.now(),g.current.selectionStart=0,g.current.selectionEnd=0,g.current.selectionStart=s[p].start,g.current.selectionEnd=s[p].end)}),[v,p,b,c]),r((()=>{i.isDate(a)&&f(function(e){const[t,r,n]=e.split(/[:\s]/);return{hours:String(Number(t)).padStart(2," "),minutes:r,meridiem:n}}(u(new Date(a),"hh:mm aa")))}),[a]),React.createElement(React.Fragment,null,React.createElement(React.Fragment,null,!0!==c&&React.createElement(n,o({size:"small",name:"value",variant:"outlined",label:m,value:null===b?"":`${b.hours}:${b.minutes} ${b.meridiem}`,inputRef:g,onChange:({target:{value:e}})=>{let[t,r,n]=e.trim().split(/[:\s]/);const u=Date.now();if("hours"===p){if(!1===s.hours.pattern.test(t))return void A();t=Number(t),f((e=>{const r=Number(e.hours);let n;return n=u-S.current<500?1===r&&t<3?"1"+t:" "+t:0===Number(t)?e.hours:" "+t,{...e,hours:n}}))}if("minutes"===p){if(console.log("minutes",r),!1===s.minutes.pattern.test(r))return void A();r=Number(r),f((e=>{let t;const n=Number(e.minutes);return t=u-S.current<500?n<6?`${n}${r}`:"0"+r:r>0?"0"+r:n,{...e,minutes:t}}))}"meridiem"===p&&f((e=>{let t;const r=e.meridiem;return t="A"===n[0].toUpperCase()||"P"===n[0].toUpperCase()?`${n[0].toUpperCase()}M`:r,{...e,meridiem:t}})),A()},onKeyDown:e=>{if("none"===p)return;const{code:t}=e;if("Enter"===t)return g.current.blur(),void h("none");["Tab","ArrowRight","ArrowLeft","ArrowUp","ArrowDown"].includes(t)&&e.preventDefault(),"Tab"!==t&&"ArrowRight"!==t||h((e=>s[e].next)),"ArrowLeft"===t&&h((e=>s[e].previous)),"ArrowUp"===t&&N("up"),"ArrowDown"===t&&N("down")},onClick:()=>{const e=g.current.selectionStart;e<s.hours.end+1?h("hours"):e<s.minutes.end?h("minutes"):h("meridiem"),A()},onBlur:()=>{const e=new Date(a);e.setHours("PM"===b.meridiem&&b.hours<12?Number(b.hours)+12:Number(b.hours)),e.setMinutes(b.minutes),h("none"),l(e)},autoComplete:"off"},d))),React.createElement(React.Fragment,null," ",!0===c&&React.createElement(n,o({size:"small",name:"value",variant:"outlined",disabled:!0,label:m,value:null===b?"":`${b.hours}:${b.minutes} ${b.meridiem}`},d))))};export{a as ReactTimeTextField};
